# Bumpy multi-stage Docker build: build app in a Docker image and publish to registry

pool:
  vmImage: 'ubuntu-latest'

variables:
  azureCrUser: 'kadluba'
  azureCrAddress: '$(azureCrUser).azurecr.io'
  dockerImage: 'bumpy:latest'
  dockerTag: '$(azureCrAddress)/samples/$(dockerImage)'

stages:
- stage: Build
  jobs:
  - job: "BuildPush"
    displayName: "Build and Push"
    steps:
    - script:  echo "$(azureCrPassword)" | docker login -u $(azureCrUser) --password-stdin $(azureCrAddress)
      displayName: "Docker ACR Login"
    - script: docker build --rm -f "Bumpy/Dockerfile" -t $(dockerTag) Bumpy
      displayName: "Docker Build"
    - script: docker push $(dockerTag)
      displayName: "Docker Push Image to ACR"
